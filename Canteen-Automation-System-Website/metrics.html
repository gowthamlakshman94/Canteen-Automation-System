<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Item-wise Metrics</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="container my-5">
    <h1>Item-wise Metrics</h1>

    <!-- Table to display item-wise metrics -->
    <h2 class="my-4">Item Metrics Table</h2>
    <table class="table table-bordered" id="metricsTable">
      <thead>
        <tr>
          <th>Item Name</th>
          <th>Total Sales</th>
          <th>Total Quantity</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data will be inserted here dynamically -->
      </tbody>
    </table>

    <!-- Graph to display item-wise metrics -->
    <h2 class="my-4">Sales & Quantity Graph</h2>
    <canvas id="metricsChart" width="400" height="200"></canvas>
  </div>

  <script>
    // Fetch data from the backend API
    fetch('http://localhost:3000/api/itemMetrics')
      .then(response => response.json())
      .then(data => {
        // Populate the table with item data
        const tableBody = document.querySelector('#metricsTable tbody');
        data.forEach(item => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${item.item_name}</td>
            <td>${item.totalSales}</td>
            <td>${item.totalQuantity}</td>
          `;
          tableBody.appendChild(row);
        });

        // Prepare data for the graph
        const labels = data.map(item => item.item_name);
        const salesData = data.map(item => item.totalSales);
        const quantityData = data.map(item => item.totalQuantity);

        // Create the bar chart
        const ctx = document.getElementById('metricsChart').getContext('2d');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [
              {
                label: 'Total Sales',
                data: salesData,
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
              },
              {
                label: 'Total Quantity',
                data: quantityData,
                backgroundColor: 'rgba(153, 102, 255, 0.5)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
              }
            ]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      })
      .catch(error => console.error('Error fetching item metrics:', error));
  </script>
</body>
</html>

